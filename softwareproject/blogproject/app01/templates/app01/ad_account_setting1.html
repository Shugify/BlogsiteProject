<!DOCTYPE html>
<html lang="en">
<head>
	{% load static %}
<meta charset="utf-8"/>
<link rel="apple-touch-icon" sizes="76x76" href="{% static 'app01/image/favicon.ico' %}">
<link rel="icon" type="image/png" href="{% static 'app01/image/favicon.ico' %}">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<title>BlogSphere博界</title>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport'/>
<!-- Google Font -->
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700|Source+Sans+Pro:400,700" rel="stylesheet">
<!-- Font Awesome Icons -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
<!-- Main CSS -->
<link href="{% static 'app01/css/main.css' %}" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

	<style>
		.nav-link.active {
     	background-color: #03a87c; /* 修改背景颜色为绿色 */
    	color: white; /* 修改文本颜色为白色 */
		}


		/* 弹窗外层容器 */
.modal {
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    display: none; /* 使用 flexbox 布局 */
    align-items: center; /* 垂直居中 */
    justify-content: center; /* 水平居中 */
    background-color: rgba(0, 0, 0, 0.4);
}

/* 弹窗内容区域 */
.modal-content {
    background-color: #fefefe;
    padding: 20px;
    border: 1px solid #888;
    width: 50%; /* 调整宽度 */
    max-width: 300px; /* 设置最大宽度 */
    height: auto; /* 自适应高度 */
    max-height: 80%; /* 设置最大高度 */
    text-align: center;
}

/* 关闭按钮样式 */
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

 .hidden {
            display: none;
        }



 body {
    background-color:#F5F6F7; /* 设置默认背景颜色为灰色 */
  }



	</style>

</head>
<body>
<!--------------------------------------
NAVBAR
--------------------------------------->
<link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
>

<nav class="topnav navbar navbar-expand-lg navbar-light bg-white fixed-top">
<div class="container">


	<div class="navbar-collapse collapse" id="navbarColor02" style="">

		<ul class="navbar-nav mr-auto d-flex align-items-center">

			<li class="nav-item ">
			<a class="nav-link" href="http://127.0.0.1:8000/ad_home/">账户管理</a>
			</li>
			<li class="nav-item pl-3">
			<a class="nav-link" href="http://127.0.0.1:8000/ad_manage_article/">文章管理</a>
			</li>

			<li class="nav-item pl-3">
			<a class="nav-link" href="http://127.0.0.1:8000/ad_manage_comment/">评论管理</a>
			</li>

			<li class="nav-item pl-3">
			<a class="nav-link" href="http://127.0.0.1:8000/ad_self_article/">我的blog</a>
			</li>

			 <li class="nav-item pl-3">
                    <a class="nav-link " href="http://127.0.0.1:8000/ad_add_category/">分类管理</a>
                </li>



		</ul>





		<ul class="navbar-nav ml-auto d-flex align-items-center">
			<li class="nav-item highlight">
				<a class="nav-link" href="http://127.0.0.1:8000/ad_send_article/">发布博客</a>
			</li>
		</ul>



		<ul class="navbar-nav ml-auto d-flex align-items-center">
			<li class="nav-item highlight">
			<a class="nav-link" href="http://127.0.0.1:8000/ad_account_setting/">个人中心</a>
			</li>
		</ul>
	</div>
</div>
</nav>
<!-- End Navbar -->
<!-- End Navbar -->



<!--------------------------------------
HEADER
--------------------------------------->

<!-- End Header -->


<!--------------------------------------
MAIN
--------------------------------------->


<div class="container mt-1 pt-2">
	<div class="row justify-content-between pt-3">
		<div class="col-md-2 pt-3 ">
			<div class="sticky-top text-center ">

				  <a class="nav-link" href="http://127.0.0.1:8000/ad_account_setting/">个人信息</a>
                <a class="nav-link  active" href="http://127.0.0.1:8000/ad_account_setting1/">账号设置</a>
                <a class="nav-link" href="http://127.0.0.1:8000/ad_register/">添加管理员</a>

			</div>
		</div>

		<div class="col-md-10 pl-5 bg-white">
			<h2 class="pb-4 font-weight-bold spanborder">账号设置</h2>
			<div class="col-md-10">


<div class="row pt-4">
    <p class="label pr-5 pt-3" style="display:inline-block; width: 150px;">电话号码&nbsp;:</p>

        <p class="pr-5 pt-3" id="administrator_phone">{{ administrator_phone }}</p>

    <button class="ml-auto btn btn-outline-success btn-sm my-2 my-sm-2" onclick="editField('administrator_phone')">修改</button>

	<div class="col-md-4 pt-4 "><span id="check_phone"></span></div>
</div>

<div class="row pt-4">
    <p class="label pr-5 pt-3" style="display:inline-block; width: 150px;">电子邮箱&nbsp;:</p>
	<p class="pr-5 pt-3" id="administrator_mail">{{ administrator_mail}}</p>

    <button class="ml-auto btn btn-outline-success btn-sm my-2 my-sm-2" onclick="editField('administrator_mail')">修改</button>
	<div class="col-md-4 pb-4 align-self-center"><span id="check_mail"></span></div>
</div>

<div class="row pt-4">
    <p class="label pr-5 pt-3" style="display:inline-block; width: 150px;">账户密码&nbsp;:</p>
	<p class="pr-5 pt-3" >********</p>

    <button class="ml-auto btn btn-outline-success btn-sm my-2 my-sm-2" onclick="redirectToPasswordPage()">修改</button>

	<div class="col-md-4  align-self-center"><span></span></div>
</div>


<div class="row pt-4">
    <button class="btn btn-outline-success btn-sm my-2 my-sm-2" onclick="confirmLogout()" >退出账号</button>
	<button class="ml-auto btn btn-outline-danger btn-sm my-2 my-sm-2" onclick="showDispose()">注销账号</button>
	<div class="col-md-4 align-self-center"><span></span></div>
</div>



			</div>



			<h6 class="font-weight-bold spanborder"><span></span></h6>

		</div>
	</div>
</div>


<div id="logoutModal" class="modal">
  <div class="modal-content">
    <p>确认退出账号？</p>
    <button class="btn btn-outline-success btn-sm my-2 my-sm-2"  onclick="logout()">确认</button>
    <button class="btn btn-outline-success btn-sm my-2 my-sm-2"  onclick="cancelLogout()">取消</button>
  </div>
</div>

<!-- 确认注销账号的弹窗 -->
<div id="disposeModal" class="modal">
  <div class="modal-content">
    <p>确认注销账号？</p>
    <button class="btn btn-outline-danger btn-sm my-2 my-sm-2" onclick="DisposeAccount()">确认</button>
    <button class="btn btn-outline-success btn-sm my-2 my-sm-2" onclick="cancelDispose()">取消</button>
  </div>
</div>

<!-- End Main -->

<!--------------------------------------
FOOTER
--------------------------------------->
<div class="container mt-1">
	<footer class="bg-white border-top p-3 text-muted ">
	<div class="row align-items-center justify-content-between">
		<div>
            <span class="navbar-brand mr-2"><strong>五元一次方程组</strong></span> 倾情制作
			<script>document.write(new Date().getFullYear())</script>
			 . Open most copyright.
		</div>
		<div>
			点击 <a target="_blank" class="text-secondary font-weight-bold" href="https://github.com/Shugify/BlogsiteProject/">这里</a> 查看项目源码.
		</div>
	</div>
	</footer>
</div>
<!-- End Footer -->

<!--------------------------------------
JAVASCRIPTS
--------------------------------------->
<script src="{% static 'app01/js/vendor/jquery.min.js' %}" type="text/javascript"></script>
<script src="{% static 'app01/js/vendor/popper.min.js' %}" type="text/javascript"></script>
<script src="{% static 'app01/js/vendor/bootstrap.min.js' %}" type="text/javascript"></script>
<script src="{% static 'app01/js/functions.js' %}" type="text/javascript"></script>


<script>
function showDispose() {
    // 显示确认注销账号的弹窗
    var modal = document.getElementById("disposeModal");
    modal.style.display = "flex";
    modal.style.alignItems = "center";
    modal.style.justifyContent = "center";
}

function cancelDispose() {
    // 隐藏确认注销账号的弹窗
    var modal = document.getElementById("disposeModal");
    modal.style.display = "none";
}

function DisposeAccount() {
    // 执行注销账号的操作
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/ad_dispose_account/', true);  // 修改为实际的注销账号路由
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.setRequestHeader('X-CSRFToken', csrfToken);

    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                // 成功注销账号后，重定向到登录页面或者其他页面
                window.location.href = '/ad_login/';  // 修改为实际的登录页面路由
            } else {
                // 处理注销账号失败的情况
                console.error('Failed to logout account');
            }
        }
    };

    // 发送空数据
    xhr.send();
}



	function confirmLogout() {
    // 显示确认退出的弹窗
     var modal = document.getElementById("logoutModal");


     modal.style.display = "flex"; // 将弹窗显示
      // 使用以下代码设置弹窗居中
      modal.style.alignItems = "center"; // 垂直居中
      modal.style.justifyContent = "center"; // 水平居中
	}

function cancelLogout() {
    // 隐藏确认退出的弹窗
    document.getElementById('logoutModal').style.display = 'none';
}

function logout() {
    // 执行退出登录的操作
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/ad_logout/', true);  // 修改为实际的退出登录路由
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.setRequestHeader('X-CSRFToken', csrfToken);

    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                // 成功退出登录后，重定向到登录页面或者其他页面
                window.location.href = '/ad_login/';  // 修改为实际的登录页面路由
            } else {
                // 处理退出登录失败的情况
                console.error('Failed to logout');
            }
        }
    };

    // 发送空数据
    xhr.send();

}




    function redirectToPasswordPage() {
        // 将页面重定向到目标 URL
        window.location.href = "http://127.0.0.1:8000/ad_account_setting1_password/";
    }
</script>


{% csrf_token %}
<script>
    var csrfToken = '{{ csrf_token }}';
</script>

<script>

function saveData(fieldName, newValue, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/ad_account_setting1/', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.setRequestHeader('X-CSRFToken', csrfToken); // 添加 CSRF 令牌
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                var responseData = JSON.parse(xhr.responseText);
                if (responseData.status === 'success') {
                    console.log("Data saved successfully!");
                    callback(6);
                } else {
                    console.error("Error saving data:", responseData.message);
                    if (responseData.error_type === 'phone_exists') {
                        callback(-1);
                    } else if (responseData.error_type === 'email_exists') {
                        callback(-2);
                    } else {
                        // 处理其他类型的错误
                        callback(null); // 或者 callback(-3); 根据具体情况处理
                    }
                }
            } else {
                console.error("Error saving data:", xhr.statusText);
                // 处理 AJAX 请求出错的情况
                callback(null); // 或者 callback(-4); 根据具体情况处理
            }
        }
    };

    // 构建 URL 编码格式的数据
    var data = 'field_name=' + encodeURIComponent(fieldName) + '&new_value=' + encodeURIComponent(newValue);
    xhr.send(data);
}



 function editField(fieldName) {
    var field = document.getElementById(fieldName);
    var currentValue = field.innerText;
    field.innerHTML = "";

    // Save original value
    field.dataset.originalValue = currentValue;

    // Hide edit button
    var editButton = field.parentElement.querySelector("button");
    if (editButton) {
        editButton.style.display = "none";
    }

    // Create input field
    if (fieldName == 'administrator_phone') {
        var inputField = document.createElement("input");
        inputField.setAttribute("type", "text");
        inputField.setAttribute("id", "edit-" + fieldName);
        inputField.value = currentValue; // Set current value
        inputField.className = "form-control";
        field.appendChild(inputField);
    }
    else if(fieldName == 'administrator_mail') {
        var inputField = document.createElement("input");
        inputField.setAttribute("type", "email");
        inputField.setAttribute("id", "edit-" + fieldName);
        inputField.value = currentValue; // Set current value
        inputField.className = "form-control";
        field.appendChild(inputField);
    }



    // Create save button
    var saveButton = document.createElement("button");
    saveButton.innerText = "Save";
    saveButton.className = "btn btn-outline-success btn-sm my-2 my-sm-2 mr-2"; // Add button classes
   	saveButton.style.marginLeft = "15px";
    saveButton.onclick = function() {
        saveEdit(fieldName);
    };

    // Create cancel button
    var cancelButton = document.createElement("button");
    cancelButton.innerText = "Cancel";
    cancelButton.className = "btn btn-outline-success btn-sm my-2 my-sm-2"; // Add button classes
    cancelButton.onclick = function() {
        cancelEdit(fieldName);
    };

    // Add save and cancel buttons to the field
    field.appendChild(saveButton);
    field.appendChild(cancelButton);
}




        function saveEdit(fieldName) {
             var field = document.getElementById(fieldName);
    var newValue;

    if (fieldName == 'administrator_phone') {
        newValue = document.getElementById("edit-" + fieldName).value;

        // 校验电话号码
        var phoneRegex = /^\d{11}$/;
        if (!phoneRegex.test(newValue)) {
            document.getElementById("check_phone").style.color = "red";
            document.getElementById("check_phone").innerText = "电话号码格式不正确";
            return; // 结束保存操作
        }
    } else if (fieldName == 'administrator_mail') {
        newValue = document.getElementById("edit-" + fieldName).value;

        // 校验电子邮箱
        var emailRegex = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
        if (!emailRegex.test(newValue)) {
            document.getElementById("check_mail").style.color = "red";
            document.getElementById("check_mail").innerText = "电子邮箱格式不正确";
            return; // 结束保存操作
        }
    }


    var judge = null; // 初始化 judge
    saveData(fieldName, newValue, function(response) {
        judge = response;
        if (judge === -1) {
            document.getElementById("check_phone").style.color = "red";
            document.getElementById("check_phone").innerText =  "电话号码已存在";

        } else if (judge === -2) {
            document.getElementById("check_mail").style.color = "red";
            document.getElementById("check_mail").innerText = "电子邮箱存在";

        }else if (judge === 6) {

        	// 正常保存后的处理
            field.innerText = newValue; // Set the new value to the field's innerText

			document.getElementById("check_phone").innerText = ""; // 清空错误信息
			document.getElementById("check_mail").innerText = ""; // 清空错误信息


    	// Show edit button
    		var editButton = field.parentElement.querySelector("button");
    		if (editButton) {
        		editButton.style.display = "inline";
    		}

        }
    });


}





        function cancelEdit(fieldName) {
            var field = document.getElementById(fieldName);
            var originalValue = field.dataset.originalValue;
            field.innerText = originalValue;

            document.getElementById("check_phone").innerText = ""; // 清空错误信息
			document.getElementById("check_mail").innerText = ""; // 清空错误信息

            // Show edit button
            var editButton = field.parentElement.querySelector("button");
            if (editButton) {
                editButton.style.display = "inline";
            }
        }


</script>




</body>
</html>
